### 概述

performSelector 系方法要比使用 NSThread 类进行多线程编程简单, 但与之前使用 GCD 的源代码相比, 结果一目了然. 相比 perfomSelector 系方法, GCD 更为简洁. 如果使用 GCD 不近不必使用 NSThread 类或 performSelector 系方法这些过时的 API, 更可以通过 GCD 提供的系统级线程管理 提高执行效率.



#### 多线程编程

线程

> "1 个 CPU 执行的 CPU 命令 列为一条无分叉路径" 即为 "线程"
>
> 线程是程序的执行流
>
> 用于指代独立执行的代码段

进程

> ⽤于指代⼀个正在运⾏的可执⾏程序，它可以包含多个线程。

任务:

> ⽤于指代抽象的概念，表示需要执⾏⼯作。

多线程

> 是⼀个采⽤相对较低的⽔平和复杂的⽅式来⽀持应⽤程序并发。如果使⽤不当，会遇到同步、定时问题
>
> 线程之间公⽤的：相同的内存、数据结构
>
> 线程之间的开销：消耗内存和CPU占⽤
>
> 多线程的底层实现机制是 ： mach

上下文切换

> CPU 的寄存器等信息保存到各自路径专用的内存块中, 从切换目标路径专用的内存块中, 复原 CPU 寄存器等信息, 继续执行切换路径的 CPU 命令列. 这被称为"上下文切换".

> 使用多线程技术的程序可以在某个线程和其他线程之间反复多次进行上下文切换,因此看上去就好像 1 个 CPU 核能够并列地执行多个线程一样. 而且再有多个 CPU 核的情况下, 就不是看上去了, 而是真的提供了多个 CPU 核并执行多个线程的技术.

问题

> + 数据竞争
> + 死锁
> + 太多线程消耗大量内存

使用原因

> 使用多线程编程, 在执行长时间的处理时仍可保证用户界面的相应性能.

#### 多线程的概念

> - ⼀个运⾏着的程序称之为进程，⼀个进程⾄少包含⼀个线程，线程是程序的执⾏流。在iOS中程序⼀旦启动就有⼀个线程⼀直运⾏，这个线程叫主线程，主线程是其他线程的⽗线程。
> - 系统中多有的线程共享进程的地址空间，所以能够⾃由的访问进程的空间变量。多线程访问的变量称之为“共享变量”，共享变量包含“全局变量”和“静态变量”。
> - 各个线程都有⾃⼰的栈，线程不能访问其他线程的栈内变量。
> - 进程是操作系统分配资源和调度的基本单位，线程是进程的基本执⾏单位，⼀个进程对应多个线程。
> - 线程⼜分为主线程和⾮主线程：
> - ⼀般来说：主线程⽤于处理UI，所有的UI操作都要在主线程进⾏，耗时操作放在⾮主线程。
> - 其实，CPU在⼀个单位时间只能处理⼀个线程（单CPU），但是可以通过快速的切换线程，就像同时在处理多个线程⼀样。
